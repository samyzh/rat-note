(window.webpackJsonp=window.webpackJsonp||[]).push([[341],{1583:function(s,a,n){"use strict";n.r(a);var t=n(19),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[s._v("#")]),s._v(" Docker")]),s._v(" "),n("h3",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),n("p",[n("code",[s._v("![](~/20-55-11.jpg)")])]),s._v(" "),n("h3",{attrs:{id:"常用管理命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用管理命令"}},[s._v("#")]),s._v(" 常用管理命令")]),s._v(" "),n("blockquote",[n("p",[s._v("docker -help")])]),s._v(" "),n("p",[n("strong",[s._v("run命令运行以及参数详解")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker run命令运行以及参数详解\n命令格式：\n-a, --attach"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            登录容器（必须是以docker run -d启动的容器）  \n-w, --workdir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("           指定容器的工作目录  \n-c, --cpu-shares"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         设置容器CPU权重，在CPU共享场景使用    \n-e, --env"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("               指定环境变量，容器中可以使用该环境变量    \n-m, --memory"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("            指定容器的内存上限    \n-P, --publish-all"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false    指定容器暴露的端口    \n-p, --publish"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("           指定容器暴露的端口   \n-h, --hostname"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("          指定容器的主机名    \n-v, --volume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            给容器挂载存储卷，挂载到容器的某个目录    \n--volumes-from"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("          给容器挂载其他容器上的卷，挂载到容器的某个目录  \n--cap-add"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("               添加权限，权限清单详见：http://linux.die.net/man/7/capabilities    \n--cap-drop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("              删除权限，权限清单详见：http://linux.die.net/man/7/capabilities    \n--cidfile"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("               运行容器后，在指定文件中写入容器PID值，一种典型的监控系统用法    \n--cpuset"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("                设置容器可以使用哪些CPU，此参数可以用来容器独占CPU    \n--device"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                添加主机设备给容器，相当于设备直通    \n--dns"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                   指定容器的dns服务器    \n--dns-search"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            指定容器的dns搜索域名，写入到容器的/etc/resolv.conf文件    \n--entrypoint"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("            覆盖image的入口点    \n--env-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("              指定环境变量文件，文件格式为每行一个环境变量    \n--expose"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                指定容器暴露的端口，即修改镜像的暴露端口    \n--link"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                  指定容器间的关联，使用其他容器的IP、env等信息    \n--lxc-conf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("              指定容器的配置文件，只有在指定--exec-driver"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lxc时使用    \n--name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("                  指定容器名字，后续可以通过名字进行容器管理，links特性需要使用名字    \n--net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),s._v("             容器网络设置:\n                                bridge 使用docker daemon指定的网桥\n                                   "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("     //容器使用主机的网络\n                                  container:NAME_or_ID  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("//使用其他容器的网路，共享IP和PORT等网络资源\n                                  none 容器使用自己的网络（类似--net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bridge"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",但是不进行配置\n\n--privileged"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false         指定容器是否为特权容器，特权容器拥有所有的capabilities    \n--restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no"')]),s._v("             指定容器停止后的重启策略:\n                                  no：容器退出时不重启\n                                  on-failure：容器故障退出（返回值非零）时重启\n                                  always：容器退出时总是重启    \n--rm"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false                 指定容器停止后自动删除容器"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("不支持以docker run -d启动的容器"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    \n--sig-proxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true           设置由代理接受并处理信号，但是SIGCHLD、SIGSTOP和SIGKILL不能被代理\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker run -it --name myjava java "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\ndocker run -it --name myjava java -p\ndocker run -it --name myjava java -v\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("strong",[s._v("执行命令")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" ：在运行的容器中执行命令\n        -d :分离模式: 在后台运行\n        -i :即使没有附加也保持STDIN（标准输入） 打开,以交互模式运行容器，通常与 -t 同时使用；\n        -t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用；\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it  f94d2c317477 /bin/bash\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("主从数据复制")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从容器到宿主机复制")]),s._v("\n docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" tomcat：/webapps/js/text.js /home/admin\n docker  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" 容器名:  容器路径       宿主机路径   \n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从宿主机到容器复制")]),s._v("\n docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /home/admin/text.js tomcat:/webapps/js\n docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" 宿主路径中文件      容器名  容器路径   \n \n docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" dockerV/file.zip  c1cb:tmp/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[n("strong",[s._v("创建镜像、修改、上传镜像")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过现在运行中的容器,做成一个新的镜像;")]),s._v("\ndocker commit "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" CONTAINER "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("REPOSITORY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主要参数选项包括：")]),s._v("\n    -a ，–author"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("”” 作者信息\n    -m，–message"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("”” 提交信息\n    -p，–pause"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true 提交是暂停容器运行\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提交")]),s._v("\ndocker commit -a "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"samy"')]),s._v(" -m "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"back up "')]),s._v(" -p containerId meeting-kz:v1115\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#复制重命名")]),s._v("\ndocker tag testimage:lastest samy/testimage:lastes\ndocker push samy/testimage:lastest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[n("strong",[s._v("导入及导出命令")])]),s._v(" "),n("blockquote",[n("p",[s._v("docker load --input 文件\ndocker load < 文件名\ndocker save xx | gzip > xx.tar.gz 加入|gzip管道才有压缩效果；")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker load "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" ./docker/images/etag:1.1.1.tar.gz\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker save redis:5-alpine "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" images/redis:5-alpine.tar.gz\n\ndocker save java "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /home/java.tar.gz\ndocker save load "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /home/java.tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("其他命令")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止所有的container（容器），这样才能够删除其中的images：")]),s._v("\ndocker stop "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" 或者 docker stop "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -aq"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果想要删除所有container（容器）的话再加一个指令：")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" 或者 docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -aq"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除images（镜像），通过image的id来指定删除谁")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#想要删除untagged images，也就是那些id为的image的话可以用")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^<none>"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{print '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v('}"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#要删除全部image（镜像）的话")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#强制删除全部image的话")]),s._v("\ndocker rmi -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有停止的容器")]),s._v("\ndocker container prune\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有不使用的镜像")]),s._v("\ndocker image prune --force --all或者docker image prune -f -a\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止、启动、杀死、重启一个容器")]),s._v("\ndocker stop Name或者ID  \ndocker start Name或者ID  \ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" Name或者ID  \ndocker restart name或者ID\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("h3",{attrs:{id:"网络模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网络模式"}},[s._v("#")]),s._v(" 网络模式")]),s._v(" "),n("h4",{attrs:{id:"五种网络模式比较"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五种网络模式比较"}},[s._v("#")]),s._v(" 五种网络模式比较")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("bridge")]),s._v("：桥接，"),n("em",[n("strong",[s._v("默认的网络驱动")])]),s._v("，如果不指定驱动，将默认使用桥接。通常用在同一个docker主机中的多个容器间通信。")]),s._v(" "),n("li",[n("strong",[s._v("host")]),s._v("：去掉容器和宿主机之间的网络隔离，"),n("strong",[s._v("直接使用宿主机的网络")]),s._v("。通常用在网络不与宿主机隔离但是其他资源需要隔离的场景。")]),s._v(" "),n("li",[n("strong",[s._v("none")]),s._v("：禁用网络。swarm不支持。")]),s._v(" "),n("li",[n("strong",[s._v("overlay")]),s._v("：叠加网络，将多个docker daemon连接到一起。"),n("strong",[s._v("主要用在运行在不同宿主机上的容器间通信")]),s._v("。")]),s._v(" "),n("li",[n("strong",[s._v("macvlan")]),s._v("：允许为容器分配一个MAC地址，让它成为一个物理设备。")])]),s._v(" "),n("h5",{attrs:{id:"模式比较-正常机器下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模式比较-正常机器下"}},[s._v("#")]),s._v(" 模式比较：正常机器下")]),s._v(" "),n("ul",[n("li",[s._v("1.bridge网络")])]),s._v(" "),n("p",[s._v("容器的默认网络模式，docker在安装时会创建一个名为docker0的Linux bridge，"),n("strong",[s._v("在不指定--network的情况下，创建的容器都会默认挂到docker0上面。")])]),s._v(" "),n("ul",[n("li",[s._v("2.host网络")])]),s._v(" "),n("p",[s._v("通过命令--network=host指定，使用host模式的容器可以直接使用docker host的IP地址与外界通信，容器内部的服务端口也可以使用宿主机的端口，"),n("strong",[s._v("不需要进行NAT，host最大的优势就是网络性能比较好，但是docker host上已经使用的端口就不能再用了，网络的隔离性不好")]),s._v("。")]),s._v(" "),n("ul",[n("li",[s._v("3.none网络")])]),s._v(" "),n("p",[s._v("这种网络模式下容器只有lo回环网络，没有其他网卡。none网络可以在容器创建时通过--network=none来指定。"),n("strong",[s._v("这种类型的网络没有办法联网，封闭的网络能很好的保证容器的安全性")]),s._v("。")]),s._v(" "),n("ul",[n("li",[s._v("4.container模式")])]),s._v(" "),n("p",[n("strong",[s._v("创建容器时使用--network=container:NAME_or_ID这个模式在创建新的容器的时候指定容器的网络和一个已经存在的容器共享一个Network Namespace")]),s._v("，但是并不为docker容器进行任何网络配置，这个docker容器没有网卡、IP、路由等信息，"),n("strong",[s._v("需要手动的去为docker容器添加网卡、配置IP等")]),s._v("。")]),s._v(" "),n("ul",[n("li",[s._v("5.user-defined模式")])]),s._v(" "),n("p",[s._v("用户自定义模式主要可选的有三种网络驱动："),n("code",[s._v("bridge")]),s._v("、"),n("code",[s._v("overlay")]),s._v("、"),n("code",[s._v("macvlan")]),s._v("。")]),s._v(" "),n("p",[n("strong",[s._v("bridge")]),s._v("驱动用于创建类似于前面提到的bridge网络；")]),s._v(" "),n("p",[n("strong",[s._v("overlay")]),s._v("和"),n("strong",[s._v("macvlan")]),s._v("驱动用于"),n("strong",[s._v("创建跨主机的网络")]),s._v("。")]),s._v(" "),n("p",[s._v("ps:window环境下，"),n("a",{attrs:{href:"https://docs.docker.com/docker-for-windows/networking/",target:"_blank",rel:"noopener noreferrer"}},[s._v("host模式不支持"),n("OutboundLink")],1),s._v("；")]),s._v(" "),n("h5",{attrs:{id:"模式比较-虚拟器下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模式比较-虚拟器下"}},[s._v("#")]),s._v(" 模式比较：虚拟器下")]),s._v(" "),n("blockquote",[n("p",[s._v("主机跟虚拟机中的docker情况下")])]),s._v(" "),n("ul",[n("li",[s._v("本地网络")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("网络类型")]),s._v(" "),n("th",[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("bridge")]),s._v(" "),n("td",[s._v("–net=bridge 默认模式,NAT转发")])]),s._v(" "),n("tr",[n("td",[s._v("host")]),s._v(" "),n("td",[s._v("–net=host 使用宿主机网络")])]),s._v(" "),n("tr",[n("td",[s._v("none")]),s._v(" "),n("td",[s._v("–net=none 无网卡")])]),s._v(" "),n("tr",[n("td",[s._v("container")]),s._v(" "),n("td",[s._v("–net=container:容器名或ID ,共用其它容器网络")])])])]),s._v(" "),n("p",[s._v("如果"),n("strong",[s._v("要是容器与宿主机进行通讯则不可选择host和container这两种网络")]),s._v("，如果你仅需要Docker容器与宿主机网段相同，容器与其他同网段节点相互通信，不与宿主机进行通信，可以使用host网络模型！")]),s._v(" "),n("ul",[n("li",[s._v("跨主机网络")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("网络类型")]),s._v(" "),n("th",[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("overlay")]),s._v(" "),n("td",[s._v("vxlan模式")])]),s._v(" "),n("tr",[n("td",[s._v("macvlan")]),s._v(" "),n("td",[s._v("使用外部lan,需手动配置")])])])]),s._v(" "),n("p",[s._v("macvlan的原理是在宿主机物理网卡上虚拟出多个子网卡，通过不同的MAC地址在数据链路层进行网络数据转发的，它是比较新的网络虚拟化技术，需要较新的内核支持，使用macVLAN模式的容器，无法ping通宿主机，宿主机也无法ping通该容器，对其他同网段的服务器和容器都可以联通。")]),s._v(" "),n("h5",{attrs:{id:"虚拟机的设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#虚拟机的设置"}},[s._v("#")]),s._v(" "),n("strong",[s._v("虚拟机的设置")])]),s._v(" "),n("p",[n("strong",[s._v("“桥接”和“NAT”的区别")]),s._v("：")]),s._v(" "),n("p",[s._v("使用NAT模式可以实现在虚拟系统里访问互联网，虚拟系统无法和本局域网中的其他真实主机进行通讯。")]),s._v(" "),n("p",[s._v("而使用桥接模式下虚拟出来的操作系统就像是局域网中的一台独立的主机，它可以访问网内任何一台机器。")]),s._v(" "),n("p",[s._v("所以Docker0是属于桥接模式。")]),s._v(" "),n("h4",{attrs:{id:"net、network-mode、networks"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#net、network-mode、networks"}},[s._v("#")]),s._v(" net、network_mode、networks")]),s._v(" "),n("p",[n("strong",[s._v("net")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#version-1",target:"_blank",rel:"noopener noreferrer"}},[s._v("Version 1 file format"),n("OutboundLink")],1),s._v(" only. In version 2, use "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#network_mode",target:"_blank",rel:"noopener noreferrer"}},[s._v("network_mode"),n("OutboundLink")],1),s._v(".")]),s._v(" "),n("p",[s._v("为容器指定网络类型，version 1专用，version 2使用network_mode.")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('net: "bridge"\nnet: "host"\nnet: "none"\nnet: "container:[service name or container name/id]"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("network_mode")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#version-2",target:"_blank",rel:"noopener noreferrer"}},[s._v("Version 2 file format"),n("OutboundLink")],1),s._v(" only. In version 1, use "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#net",target:"_blank",rel:"noopener noreferrer"}},[s._v("net"),n("OutboundLink")],1),s._v(".")]),s._v(" "),n("p",[s._v("为容器指定网络类型.")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('network_mode: "bridge"\nnetwork_mode: "host"\nnetwork_mode: "none"\nnetwork_mode: "service:[service name]"\nnetwork_mode: "container:[container name/id]"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("networks")])]),s._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#version-2",target:"_blank",rel:"noopener noreferrer"}},[s._v("Version 2 file format"),n("OutboundLink")],1),s._v(" only. In version 1, use "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#net",target:"_blank",rel:"noopener noreferrer"}},[s._v("net"),n("OutboundLink")],1),s._v(".")])]),s._v(" "),n("p",[s._v("Networks to join, referencing entries under the "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/#network-configuration-reference",target:"_blank",rel:"noopener noreferrer"}},[s._v("top-level "),n("code",[s._v("networks")]),s._v(" key"),n("OutboundLink")],1),s._v(".")]),s._v(" "),n("p",[s._v("services:")]),s._v(" "),n("p",[s._v("some-service:")]),s._v(" "),n("p",[s._v("networks:")]),s._v(" "),n("p",[s._v("- some-network")]),s._v(" "),n("p",[s._v("- other-network")]),s._v(" "),n("p",[s._v("指定网络模式。"),n("strong",[s._v('注意“network_mode: "host"”不能与 links 选项合用。')])]),s._v(" "),n("p",[s._v("** links\n关联另一个服务中的容器。如果同时指定了该选项和 networks 选项，那个关联的服务之间应该至少要有一个共同的网络才能相互通信。")]),s._v(" "),n("h3",{attrs:{id:"镜像压缩与优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像压缩与优化"}},[s._v("#")]),s._v(" 镜像压缩与优化")]),s._v(" "),n("p",[n("strong",[s._v("压缩镜像主要有以下")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("1、选择比较小的基础镜像，也就是FROM后面的那个镜像尽量要小; 比如：alpine")]),s._v(" "),n("ul",[n("li",[s._v("对比常用的、没有压缩过的基础镜像（在写作时使用的是:latest标签）：\n"),n("ul",[n("li",[n("code",[s._v("Alpine")]),s._v(" - 4.8MB")]),s._v(" "),n("li",[n("code",[s._v("Ubuntu")]),s._v(" - 124.8 MB")]),s._v(" "),n("li",[n("code",[s._v("Centos")]),s._v(" - 196MB")])])])])]),s._v(" "),n("li",[n("p",[s._v("2、RUN 命令要尽量写在一条里，每次 RUN 命令都是在之前的镜像上封装，只会增大不会减小;")]),s._v(" "),n("ul",[n("li",[s._v("不用修改固定层放一起,常用修改的一层分开处理下一层;")])])]),s._v(" "),n("li",[n("p",[s._v("3、每次进行依赖安装后，记得yum clean all【centos】")])]),s._v(" "),n("li",[n("p",[s._v("yum clean all 清除缓存中的rpm头文件和包文件")])])]),s._v(" "),n("h3",{attrs:{id:"镜像打包加速"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像打包加速"}},[s._v("#")]),s._v(" 镜像打包加速")]),s._v(" "),n("ul",[n("li",[s._v("1：镜像压缩优化；")]),s._v(" "),n("li",[s._v("2：借助阿里云镜像在线打包及加速配置；")]),s._v(" "),n("li",[s._v("3：分基处理打镜像,再分具体业务镜像； pdftk,liboffice；")])]),s._v(" "),n("h3",{attrs:{id:"dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),n("h4",{attrs:{id:"构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[s._v("#")]),s._v(" 构建")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用说明:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动脚本:sudo bash ./docker/build.sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker build -t etag -f docker/Dockerfile "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"源、时间动态设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源、时间动态设置"}},[s._v("#")]),s._v(" 源、时间动态设置")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" alpine"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.9\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置时区为上海")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apk add tzdata && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n    && echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /etc/timezone \\\n    && apk del tzdata\n    \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://mirrors.aliyun.com/alpine/v3.7/main/"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /etc/apk/repositories\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#apk update")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("示例：")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("16.04\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" author="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"samy"')]),s._v(" version="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y sudo \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y language"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("hans \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y language"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("en \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install python2.7 python2.7"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev make gcc "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y curl \\\n    && curl "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sL https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//deb.nodesource.com/setup_10.x "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" sudo "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("E bash "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y nodejs \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("essential \\\n    && apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y vim && \\\n    rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf /tmp/* /var/lib/apt/* /var/cache/* /var/log/*\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" LANG en_US.UTF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8 \\\n    && NODE_PATH=/usr/local/lib/node_modules/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/local/lib  NODE_ENV=docker \\\n    && PRO_PATH ./\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" ../\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("g cnpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("registry=https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry.npm.taobao.org \\\n    && cnpm install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("g node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gyp \\\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   && cnpm install -g pm2 \\")]),s._v("\n    && cnpm install\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pm2-docker"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-process.json"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8004\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("10.14"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apk "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("update add tzdata \\\n    && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n    && echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /etc/timezone \\\n    && apk del tzdata\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apk add "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("update "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cache make gcc g++ \\\n    curl bash tree vim git \\\n&& rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r /usr/share/man \\\n&& rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r /var/cache/apk/*\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PYTHONUNBUFFERED=1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install python3 & pip3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apk add "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cache python python"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev && \\\n    python3 python3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev \\\n    linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("headers build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("base ca"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("certificates && \\\n    python3 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("m ensurepip && \\\n    rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r /usr/lib/python*/ensurepip && \\\n    pip3 install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("upgrade pip setuptools && \\\n    pip3 install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cache Pillow numpy PyCRC qrcode argparse && \\\n    if "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ! "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("e /usr/bin/pip "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("; then ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s pip3 /usr/bin/pip ; fi && \\\n    rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("r /root/.cache\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /usr/src/app\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /usr/src/app\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package.json /usr/src/app/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN npm i  --registry=https://registry.npm.taobao.org --production")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm i  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("registry=https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry.npm.taobao.org\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .\n   \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 7082\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CMD npm run docker")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" npm run dev\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("h2",{attrs:{id:"docker-compose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" Docker compose")]),s._v(" "),n("h3",{attrs:{id:"常见命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见命令"}},[s._v("#")]),s._v(" 常见命令")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("ps")]),s._v("：列出所有运行容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("logs")]),s._v("：查看服务日志输出")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose logs\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("port")]),s._v("：打印绑定的公共端口，下面命令可以输出 eureka 服务 8761 端口所绑定的公共端口")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose port eureka "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8761")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("build")]),s._v("：构建或者重新构建服务")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose build\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("start")]),s._v("：启动指定服务已存在的容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose start eureka\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("stop")]),s._v("：停止已运行的服务的容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose stop eureka\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("rm")]),s._v("：删除指定服务的容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" eureka\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("up")]),s._v("：构建、启动容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose up\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("kill")]),s._v("：通过发送 SIGKILL 信号来停止指定服务的容器")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" eureka\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("pull")]),s._v("：下载服务镜像")]),s._v(" "),n("li",[n("strong",[s._v("scale")]),s._v("：设置指定服务运气容器的个数，以 service=num 形式指定")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose scale "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("movie")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("run")]),s._v("：在一个服务上执行一个命令")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker-compose run web "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"docker-compose-yml-属性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml-属性"}},[s._v("#")]),s._v(" docker-compose.yml 属性")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("version")]),s._v("：指定 docker-compose.yml 文件的写法格式")]),s._v(" "),n("li",[n("strong",[s._v("services")]),s._v("：多个容器集合")]),s._v(" "),n("li",[n("strong",[s._v("build")]),s._v("：配置构建时，Compose 会利用它自动构建镜像，该值可以是一个路径，也可以是一个对象，用于指定 Dockerfile 参数")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build: ./dir\n---------------\nbuild:\n    context: ./dir\n    dockerfile: Dockerfile\n    args:\n        buildno: 1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("command")]),s._v("：覆盖容器启动后默认执行的命令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("command: bundle exec thin -p 3000\n----------------------------------\ncommand: [bundle,exec,thin,-p,3000]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("dns")]),s._v("：配置 dns 服务器，可以是一个值或列表")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("dns: 8.8.8.8\n------------\ndns:\n    - 8.8.8.8\n    - 9.9.9.9\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("dns_search")]),s._v("：配置 DNS 搜索域，可以是一个值或列表")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("dns_search: example.com\n------------------------\ndns_search:\n    - dc1.example.com\n    - dc2.example.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("environment")]),s._v("：环境变量配置，可以用数组或字典两种方式")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("environment:\n    RACK_ENV: development\n    SHOW: 'ture'\n-------------------------\nenvironment:\n    - RACK_ENV=development\n    - SHOW=ture\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("env_file")]),s._v("：从文件中获取环境变量，可以指定一个文件路径或路径列表，其优先级低于 environment 指定的环境变量")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("env_file: .env\n---------------\nenv_file:\n    - ./common.env\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("expose")]),s._v("：暴露端口，只将端口暴露给连接的服务，而不暴露给主机")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('expose:\n    - "3000"\n    - "8000"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("image")]),s._v("：指定服务所使用的镜像")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("image: java\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("network_mode")]),s._v("：设置网络模式")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('network_mode: "bridge"\nnetwork_mode: "host"\nnetwork_mode: "none"\nnetwork_mode: "service:[service name]"\nnetwork_mode: "container:[container name/id]"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("ports")]),s._v("：对外暴露的端口定义，和 expose 对应")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('ports:   # 暴露端口信息  - "宿主机端口:容器暴露端口"\n- "8763:8763"\n- "8763:8763"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("links")]),s._v("：将指定容器连接到当前连接，可以设置别名，避免ip方式导致的容器重启动态改变的无法连接情况")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("links:    # 指定服务名称:别名 \n    - docker-compose-eureka-server:compose-eureka\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("volumes")]),s._v("：卷挂载路径")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("volumes:\n  - /lib\n  - /var\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[n("strong",[s._v("logs")]),s._v("：日志输出信息")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("--no-color          单色输出，不显示其他颜.\n-f, --follow        跟踪日志输出，就是可以实时查看日志\n-t, --timestamps    显示时间戳\n--tail              从日志的结尾显示，--tail=200\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"docker-compose-其它"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-其它"}},[s._v("#")]),s._v(" Docker Compose 其它")]),s._v(" "),n("h4",{attrs:{id:"更新容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新容器"}},[s._v("#")]),s._v(" 更新容器")]),s._v(" "),n("ul",[n("li",[s._v("当服务的配置发生更改时，可使用 docker-compose up 命令更新配置")]),s._v(" "),n("li",[s._v("此时，Compose 会删除旧容器并创建新容器，新容器会以不同的 IP 地址加入网络，名称保持不变，任何指向旧容起的连接都会被关闭，重新找到新容器并连接上去")])]),s._v(" "),n("h4",{attrs:{id:"links"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#links"}},[s._v("#")]),s._v(" links")]),s._v(" "),n("ul",[n("li",[s._v("服务之间可以使用服务名称相互访问，links 允许定义一个别名，从而使用该别名访问其它服务")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("version: '2'\nservices:\n    web:\n        build: .\n        links:\n            - \"db:database\"\n    db:\n        image: postgres\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("这样 Web 服务就可以使用 db 或 database 作为 hostname 访问 db 服务了")])]),s._v(" "),n("h4",{attrs:{id:"build"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[s._v("#")]),s._v(" build")]),s._v(" "),n("p",[s._v("服务除了可以基于指定的镜像，还可以基于一份 Dockerfile，在使用 up 启动之时执行构建任务，这个构建标签就是 build，它可以指定 Dockerfile 所在文件夹的路径。Compose 将会利用它自动构建这个镜像，然后使用这个镜像启动服务容器。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build: /path/to/build/dir\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("也可以是相对路径，只要上下文确定就可以读取到 Dockerfile。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build: ./dir\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("设定上下文根目录，然后以该目录为准指定 Dockerfile。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build:\n  context: ../\n  dockerfile: path/of/Dockerfile\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("注意 build 都是一个目录，如果你要指定 Dockerfile 文件需要在 build 标签的子级标签中使用 dockerfile 标签指定，如上面的例子。\n如果你同时指定了 image 和 build 两个标签，那么 Compose 会构建镜像并且把镜像命名为 image 后面的那个名字。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build: ./dir\nimage: webapp:tag\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("既然可以在 docker-compose.yml 中定义构建任务，那么一定少不了 arg 这个标签，就像 Dockerfile 中的 ARG 指令，它可以在构建过程中指定环境变量，但是在构建成功后取消，在 docker-compose.yml 文件中也支持这样的写法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build:\n  context: .\n  args:\n    buildno: 1\n    password: secret\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("下面这种写法也是支持的，一般来说下面的写法更适合阅读。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("build:\n  context: .\n  args:\n    - buildno=1\n    - password=secret\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("与 ENV 不同的是，ARG 是允许空值的。例如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("args:\n  - buildno\n  - password\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("这样构建过程可以向它们赋值。")]),s._v(" "),n("p",[n("strong",[s._v("mysql配置及启动依赖")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("links")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("character"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("collation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4_unicode_ci "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("connect='SET NAMES utf8mb4;' "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("innodb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flush"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("at"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("trx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("commit=0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"常用示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用示例"}},[s._v("#")]),s._v(" 常用示例")]),s._v(" "),n("p",[n("code",[s._v("docker-compose.yml")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.2'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/redis/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/data\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5.7.24\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/mysql/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/mysql\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/mysql/init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("entrypoint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("initdb.d/\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("character"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("collation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4_unicode_ci "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("connect='SET NAMES utf8mb4;' "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("innodb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flush"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("at"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("trx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("commit=0\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_ROOT_PASSWORD=xxx\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - MYSQL_DATABASE=etag_dev")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("etag")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" etag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.1.1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network_mode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" host\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/config/config.json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/src/app/database/config.json\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/config/config.default.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/src/app/config/config.default.js\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/config/config.prod.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/src/app/config/config.prod.js\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/logs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/src/app/logs\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /srv/etag/public"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/src/app/public\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("FROM node:10.14-alpine\n\nRUN apk --update "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" tzdata "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/share/zoneinfo/Asia/Shanghai /etc/localtime "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Shanghai"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/timezone "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" apk del tzdata\n\nRUN apk "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --update --no-cache "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" gcc g++ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" tree "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -r /usr/share/man "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -r /var/cache/apk/*\n\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PYTHONUNBUFFERED")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install python3 & pip3")]),s._v("\nRUN apk "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --no-cache python python-dev "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     python3 python3-dev \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     linux-headers build-base ca-certificates && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     python3 -m ensurepip && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     rm -r /usr/lib/python*/ensurepip && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     pip3 install --upgrade pip setuptools && \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     pip3 install --no-cache Pillow numpy PyCRC qrcode argparse && \\")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    if [ ! -e /usr/bin/pip ]; then ln -s pip3 /usr/bin/pip ; fi && \\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -r /root/.cache\n\n\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/src/app\nWORKDIR /usr/src/app\n\nCOPY package.json /usr/src/app/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN npm i  --registry=https://registry.npm.taobao.org --production")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i  --registry"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://registry.npm.taobao.org\n\nCOPY "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n   \nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7082")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CMD npm run docker")]),s._v("\nCMD "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run dev\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.2'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("delos")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("delos\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# build from ./Dockerfile")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    build: .")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# build from images")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# you can find last tag from https://hub.docker.com/r/blackdog1987/rap2-delos")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" blackdog1987/rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("delos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("2.6.aa3be03\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if you have your own mysql, config it here, and disable the 'mysql' config blow")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_URL=rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysql "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# links will maintain /etc/hosts, just use 'container_name'")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_PORT=3306\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_USERNAME=root\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_PASSWD=\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_SCHEMA=rap2\n\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis config")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REDIS_URL=rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" REDIS_PORT=6379\n\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# production / development")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" NODE_ENV=production\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("working_dir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /app\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###### 'sleep 30 && node scripts/init' will drop the tables")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###### RUN ONLY ONCE THEN REMOVE 'sleep 30 && node scripts/init'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /bin/sh "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c 'sleep 30; node scripts/init; node dispatch.js'\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# init the databases")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    command: sleep 30 && node scripts/init && node dispatch.js")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# without init")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    command: node dispatch.js")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("links")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"38080:8080"')]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# expose 38080")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("4.0.9\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# disable this if you have your own mysql")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rap2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("mysql\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5.7.22\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# expose 33306 to client (navicat)")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ports:")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - 33306:3306")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# change './docker/mysql/volume' to your own path")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WARNING: without this line, your data will be lost.")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./docker/mysql/volume:/var/lib/mysql"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("character"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("collation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4_unicode_ci "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("connect='SET NAMES utf8mb4;' "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("innodb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("flush"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("at"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("trx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("commit=0\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_ALLOW_EMPTY_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_DATABASE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rap2"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_USER")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_PASSWORD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br")])]),n("h2",{attrs:{id:"docker-swarm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm"}},[s._v("#")]),s._v(" Docker swarm")]),s._v(" "),n("p",[n("strong",[s._v("docker部署 code-push-server")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("//启动swarm\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker swarm init\n//部署\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker stack deploy -c docker-compose.yml code-push-server\n//查看服务日志\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" logs code-push-server_server\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" logs code-push-server_db\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" logs code-push-server_redis\n//销毁退出应用\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker stack "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" code-push-server\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker swarm leave --force\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);